from ipaddress import IPv4Network
from pandas import DataFrame, concat
from modules.virus_total_util import VirusTotalAnalyzer
from modules.mb_util import MalwarebytesLogManager


VTA = VirusTotalAnalyzer(config_json='config.json')

MBM = MalwarebytesLogManager(only_inbound=True)

ip_info = DataFrame()

for ip in MBM.get_inbound_ip_detections():
    scan = VTA.scan_ip(ip)
    if VTA.is_malicious_ip(scan):
        subnet = VTA.get_ip_subnet(scan)
        country = VTA.get_ip_country(scan)
        ip_range = IPv4Network(subnet)
        info = {"country":[country],"ip":[ip],"subnet":[subnet],"ip range":[f"{ip_range[0]} - {ip_range[-1]}"]}
        ip_info = concat([ip_info, DataFrame(info)], ignore_index=True)

print(ip_info)
        