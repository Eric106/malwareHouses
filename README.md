# Python util to get info of  malicious IP/URLs, for network security purposes

## Setup `config.json` for VirusTotal (API V3) module
Create a json file to store your API key

```json
{
    "api_key": "YourAPIkey"
}
```
Then you can call the module analyzer like this
```python
from modules.virus_total_util import VirusTotalAnalyzer
VTA = VirusTotalAnalyzer('config.json')

scan : dict = VTA.scan_ip('51.15.70.79')
if VTA.is_malicious_ip(scan):
    """
    Code to execute when the ip is malicious
    """
```

## MalwareBytes module
If you have the most recent version of Windows MalwareBytes Premium you can also use my own python module to retrieve the malicious inbound IPs. 
```python
from modules.mb_util import MalwarebytesLogManager

MBM = MalwarebytesLogManager()

for ip in MBM.get_inbound_ip_detections():
    """
    then scan the ip for details
    """
```
## Content `main.py` 
```python
from ipaddress import IPv4Network
from pandas import DataFrame, concat
from modules.virus_total_util import VirusTotalAnalyzer
from modules.mb_util import MalwarebytesLogManager


VTA = VirusTotalAnalyzer('config.json')

MBM = MalwarebytesLogManager()

ip_info = DataFrame()

for ip in MBM.get_inbound_ip_detections():
    scan = VTA.scan_ip(ip)
    if VTA.is_malicious_ip(scan):
        subnet = VTA.get_ip_subnet(scan)
        country = VTA.get_ip_country(scan)
        ip_range = IPv4Network(subnet)
        info = {"country":[country],"ip":[ip],"subnet":[subnet],"ip range":[f"{ip_range[0]} - {ip_range[-1]}"]}
        ip_info = concat([ip_info, DataFrame(info)], ignore_index=True)

print(ip_info)
```

##  Running `main.py`
```txt
  country               ip           subnet                        ip range
0      NL    64.227.78.253    64.227.0.0/17     64.227.0.0 - 64.227.127.255
1      FR      51.158.69.2    51.158.0.0/15     51.158.0.0 - 51.159.255.255
2      FR      51.15.70.79     51.15.0.0/16       51.15.0.0 - 51.15.255.255
3      US  198.199.116.138  198.199.64.0/18  198.199.64.0 - 198.199.127.255
4      RU   91.218.115.137  91.218.112.0/22   91.218.112.0 - 91.218.115.255
5      US   107.170.227.30   107.170.0.0/16   107.170.0.0 - 107.170.255.255
6      CN      106.75.3.57    106.75.0.0/17     106.75.0.0 - 106.75.127.255
7      RU    185.81.68.253   185.81.68.0/24     185.81.68.0 - 185.81.68.255
8      US     45.79.179.49   45.79.128.0/18     45.79.128.0 - 45.79.191.255
```